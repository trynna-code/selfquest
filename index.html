<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyMemoir</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Add Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js"></script>
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="MyMemoir" />
  <link rel="manifest" href="/site.webmanifest" />
  <style>
    /* Custom Styles */
    body {
      background-color: #0f172a;
      color: #ffffff;
      font-family: 'Inter', sans-serif;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    body.light-mode {
      background-color: #f3f4f6;
      color: #000000;
    }
    .level-bar div, .skill-bar div {
      width: 10%;
      height: 20px;
      background-color: #334155;
      margin-right: 2px;
      border: 1px solid #475569;
    }
    .level-bar div.filled, .skill-bar div.filled {
      background-color: #3b82f6;
    }
    .light-mode .level-bar div, .light-mode .skill-bar div {
      background-color: #e5e7eb;
      border-color: #d1d5db;
    }
    .light-mode .level-bar div.filled, .light-mode .skill-bar div.filled {
      background-color: #2563eb;
    }
    .page {
      display: none;
    }
    .page.active {
      display: block;
    }
    .completed {
      text-decoration: line-through;
      color: #6b7280;
    }
    .header-gradient {
      background: linear-gradient(90deg, #1e293b, #334155);
    }
    .card-bg {
      background-color: #1e293b;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      color: #ffffff;
    }
    .light-mode .card-bg {
      background-color: #ffffff;
      color: #000000;
    }
    .button-primary {
      background-color: #3b82f6;
      color: white;
      transition: background-color 0.3s ease;
    }
    .button-primary:hover {
      background-color: #2563eb;
    }
    .button-secondary {
      background-color: #475569;
      color: white;
      transition: background-color 0.3s ease;
    }
    .button-secondary:hover {
      background-color: #64748b;
    }
    .light-mode .button-secondary {
      background-color: #e5e7eb;
      color: #1f2937;
    }
    .light-mode .button-secondary:hover {
      background-color: #d1d5db;
    }
    .input-field {
      background-color: #334155;
      border: 1px solid #475569;
      color: #ffffff;
      border-radius: 4px;
      padding: 8px;
    }
    .light-mode .input-field {
      background-color: #ffffff;
      border-color: #e5e7eb;
      color: #1f2937;
    }
    .input-field:focus {
      outline: none;
      border-color: #3b82f6;
    }
    /* Logo styling */
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-text {
      font-family: 'Cinzel', serif;
      font-size: 32px;
      font-weight: bold;
      background: linear-gradient(90deg, #3b82f6, #1e3a8a);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      color: #ffffff;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    /* Logo circle with gradient background */
    .logo-circle {
      width: 40px;
      height: 40px;
      background: linear-gradient(90deg, #3b82f6, #1e3a8a);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .logo-circle span {
      color: white;
      font-weight: bold;
      font-size: 20px;
      font-family: 'Cinzel', serif;
    }
    /* Navigation links with solid color */
    .nav-link {
      color: #3b82f6; /* Solid blue color */
      text-decoration: none;
      transition: opacity 0.3s ease;
    }
    .nav-link:hover {
      opacity: 0.8;
      text-decoration: underline;
    }
    /* Fix for Rules and Missions sections in light mode */
    .light-mode .bg-gray-800 {
      background-color: #f3f4f6;
      color: #000000;
    }
    .light-mode .bg-gray-800 h3,
    .light-mode .bg-gray-800 p {
      color: #000000;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900 light-mode">
  <!-- Welcome Page -->
  <section id="welcome" class="page active">
    <div class="flex items-center justify-center min-h-screen">
      <div class="card-bg p-8 rounded-lg w-96">
        <h2 class="text-2xl font-bold mb-6 text-center">Welcome to MyMemoir</h2>
        <form id="login-form">
          <div class="mb-4">
            <label class="block mb-2">Email:</label>
            <input type="email" id="login-email" class="input-field w-full" placeholder="Enter your email" required>
          </div>
          <div class="mb-6">
            <label class="block mb-2">Password:</label>
            <input type="password" id="login-password" class="input-field w-full" placeholder="Enter your password" required>
          </div>
          <button type="submit" class="button-primary w-full py-2 px-4 rounded">Login</button>
        </form>
        <p class="text-center mt-4">Don't have an account? <a href="#" id="show-register" class="nav-link">Register here</a></p>
      </div>
    </div>
  </section>

  <!-- Registration Page -->
  <section id="register" class="page">
    <div class="flex items-center justify-center min-h-screen">
      <div class="card-bg p-8 rounded-lg w-96">
        <h2 class="text-2xl font-bold mb-6 text-center">Register</h2>
        <form id="register-form">
          <div class="mb-4">
            <label class="block mb-2">Email:</label>
            <input type="email" id="register-email" class="input-field w-full" placeholder="Enter your email" required>
          </div>
          <div class="mb-4">
            <label class="block mb-2">Password:</label>
            <input type="password" id="register-password" class="input-field w-full" placeholder="Enter your password" required>
          </div>
          <div class="mb-6">
            <label class="block mb-2">Confirm Password:</label>
            <input type="password" id="register-confirm-password" class="input-field w-full" placeholder="Confirm your password" required>
          </div>
          <button type="submit" class="button-primary w-full py-2 px-4 rounded">Register</button>
        </form>
        <p class="text-center mt-4">Already have an account? <a href="#" id="show-login" class="nav-link">Login here</a></p>
      </div>
    </div>
  </section>

  <!-- Main Content (Hidden Initially) -->
  <main class="p-6 hidden">
    <!-- Header and Navigation -->
    <header class="header-gradient p-4">
      <div class="flex items-center">
        <div class="logo">
          <!-- Logo with gradient background -->
          <div class="logo-circle">
            <span>M</span>
          </div>
          <span class="logo-text">MyMemoir</span>
        </div>
      </div>
      <nav class="mt-2">
        <ul class="flex space-x-4">
          <li><a href="#level" data-page="level" class="nav-link">Level</a></li>
          <li><a href="#skills" data-page="skills" class="nav-link">Skills</a></li>
          <li><a href="#missions" data-page="missions" class="nav-link">Missions</a></li>
          <li><a href="#rules" data-page="rules" class="nav-link">Rules</a></li>
          <li><a href="#profile" data-page="profile" class="nav-link">Profile</a></li>
        </ul>
      </nav>
    </header>

    <!-- Level Section -->
    <section id="level" class="page active">
      <h2 class="text-2xl font-bold mb-4">Level Progress</h2>
      <div class="card-bg p-6">
        <h3 id="display-name" class="text-xl font-semibold">John Doe</h3>
        <div class="level-bar flex mt-4">
          <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
        </div>
        <p id="current-level" class="mt-4">Level: 1</p>
        <p id="exp-result" class="mt-4 text-lg font-semibold">EXP: 0 / 10000</p>

        <div class="grid grid-cols-2 gap-4 mt-6">
          <div>
            <label>üçé Food (kcal):</label>
            <input type="number" id="food-input" class="input-field w-full" placeholder="Enter calories">
          </div>
          <div>
            <label>üéÆ Entertainment (hours):</label>
            <input type="number" id="entertainment-input" class="input-field w-full" placeholder="Enter hours">
          </div>
          <div>
            <label>üèãÔ∏è Sports:</label>
            <select id="sports-input" class="input-field w-full">
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </div>
          <div>
            <label>üíª Work (hours):</label>
            <input type="number" id="work-input" class="input-field w-full" placeholder="Enter hours">
          </div>
          <div>
            <label>üíß Water Intake:</label>
            <div id="water-input" class="flex space-x-2 mt-2">
              <input type="checkbox" value="0.5" class="water-box"> <input type="checkbox" value="0.5" class="water-box"> <input type="checkbox" value="0.5" class="water-box"> <input type="checkbox" value="0.5" class="water-box">
              <input type="checkbox" value="0.5" class="water-box"> <input type="checkbox" value="0.5" class="water-box"> <input type="checkbox" value="0.5" class="water-box"> <input type="checkbox" value="0.5" class="water-box">
            </div>
          </div>
        </div>
        <button id="calculate-points" class="button-primary mt-4 w-full py-2 px-4 rounded">Calculate Points</button>
      </div>
    </section>

    <!-- Skills Section -->
    <section id="skills" class="page">
      <h2 class="text-2xl font-bold mb-4">Skills</h2>
      <div class="card-bg p-6">
        <div class="flex items-center mb-4">
          <span class="mr-4">ü§ù Social Skills</span>
          <div class="skill-bar flex flex-1" id="social-skills-bar">
            <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
          </div>
        </div>
        <div class="flex items-center mb-4">
          <span class="mr-4">üìò Knowledge</span>
          <div class="skill-bar flex flex-1" id="knowledge-bar">
            <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
          </div>
        </div>
        <div class="flex items-center mb-4">
          <span class="mr-4">üèãÔ∏è Athleticism</span>
          <div class="skill-bar flex flex-1" id="athleticism-bar">
            <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
          </div>
        </div>
        <div class="flex items-center">
          <span class="mr-4">üé® Individual Skill</span>
          <div class="skill-bar flex flex-1" id="individual-skill-bar">
            <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Missions Section -->
    <section id="missions" class="page">
      <h2 class="text-2xl font-bold mb-4">Missions</h2>
      <div class="card-bg p-6">
        <!-- Current Mission -->
        <div class="mb-6">
          <h3 class="text-xl font-semibold mb-2">Personal Mission</h3>
          <div class="flex items-center justify-between bg-gray-800 p-4 rounded-lg">
            <p id="current-mission" class="text-lg">No mission set for this week.</p>
            <input type="checkbox" id="complete-mission" class="w-6 h-6">
          </div>
        </div>

        <!-- Missions Table -->
        <h3 class="text-xl font-semibold mb-4">Weekly Missions</h3>
        <table class="w-full border-collapse">
          <thead>
            <tr class="bg-gray-800">
              <th class="border p-2">Week</th>
              <th class="border p-2">Mission</th>
              <th class="border p-2">Type</th>
              <th class="border p-2">Actions</th>
            </tr>
          </thead>
          <tbody id="missions-table-body">
            <!-- Rows will be added dynamically -->
          </tbody>
        </table>
        <button id="add-mission" class="button-primary mt-4 w-full py-2 px-4 rounded">Add New Mission</button>
      </div>
    </section>

    <!-- Rules Section -->
    <section id="rules" class="page">
      <h2 class="text-2xl font-bold mb-4">Rules</h2>
      <div class="card-bg p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="text-lg font-semibold mb-2">üçé Food</h3>
            <p>1000 kcal = 100 EXP (max 300 EXP).</p>
          </div>
          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="text-lg font-semibold mb-2">üéÆ Entertainment</h3>
            <p>Start with 500 EXP, lose 100 EXP per hour.</p>
          </div>
          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="text-lg font-semibold mb-2">üèãÔ∏è Sports</h3>
            <p>Active (Yes) = +200 EXP, Inactive (No) = -50 EXP.</p>
          </div>
          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="text-lg font-semibold mb-2">üíª Work</h3>
            <p>+100 EXP per hour.</p>
          </div>
          <div class="bg-gray-800 p-4 rounded-lg">
            <h3 class="text-lg font-semibold mb-2">üíß Water</h3>
            <p>Drink 2.5L (5 boxes) = +50 EXP; every box above adds +10 EXP. Less = -50 EXP.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Profile Section -->
    <section id="profile" class="page">
      <h2 class="text-2xl font-bold mb-4">Profile</h2>
      <div class="card-bg p-6">
        <label class="block mb-2">Name:<input type="text" id="name" value="John Doe" class="input-field w-full" disabled></label>
        <label class="block mb-2">Age:<input type="number" id="age" value="25" class="input-field w-full" disabled></label>
        <label class="block mb-2">Height (cm):<input type="number" id="height" value="180" class="input-field w-full" disabled></label>
        <label class="block mb-2">Weight (kg):<input type="number" id="weight" value="75" class="input-field w-full" disabled></label>
        <label class="block mb-2">Status:<input type="text" id="status" value="Active" class="input-field w-full" disabled></label>
        <label class="block">Relationship Status:<input type="text" id="relationship" value="Single" class="input-field w-full" disabled></label>
        <div class="flex space-x-4 mt-4">
          <button id="edit-profile" class="button-primary py-2 px-4 rounded">Edit</button>
          <button id="save-profile" class="button-secondary py-2 px-4 rounded hidden">Save</button>
          <button id="toggle-dark-mode" class="button-secondary py-2 px-4 rounded">Toggle Dark Mode</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white p-4 text-center">
    <p>¬© 2025 MyMemoir. All rights reserved.</p>
  </footer>

  <!-- Add Mission Modal -->
  <div id="add-mission-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center">
    <div class="card-bg p-6 rounded-lg w-96">
      <h3 class="text-xl font-semibold mb-4">Add New Mission</h3>
      <label class="block mb-2">Mission Description:
        <input type="text" id="mission-description" class="input-field w-full" placeholder="Enter mission description">
      </label>
      <label class="block mb-4">Mission Type:
        <select id="mission-type" class="input-field w-full">
          <option value="Social Skills">Social Skills</option>
          <option value="Knowledge">Knowledge</option>
          <option value="Athleticism">Athleticism</option>
          <option value="Individual Skill">Individual Skill</option>
        </select>
      </label>
      <div class="flex justify-end space-x-4">
        <button id="cancel-mission" class="button-secondary py-2 px-4 rounded">Cancel</button>
        <button id="save-mission" class="button-primary py-2 px-4 rounded">Save</button>
      </div>
    </div>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCuPDDpJrGsnbVnEjJLCwpkWpiJuZT1qLw",
      authDomain: "mymemoir-17322.firebaseapp.com",
      projectId: "mymemoir-17322",
      storageBucket: "mymemoir-17322.firebasestorage.app",
      messagingSenderId: "758800645066",
      appId: "1:758800645066:web:8fbb2e17dd10e388a4ad33",
      measurementId: "G-50ZW2DMJG8"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    // Welcome Page Logic
    const welcomePage = document.getElementById('welcome');
    const registerPage = document.getElementById('register');
    const mainContent = document.querySelector('main');
    const showRegisterLink = document.getElementById('show-register');
    const showLoginLink = document.getElementById('show-login');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');

    showRegisterLink.addEventListener('click', (e) => {
      e.preventDefault();
      welcomePage.classList.remove('active');
      registerPage.classList.add('active');
    });

    showLoginLink.addEventListener('click', (e) => {
      e.preventDefault();
      registerPage.classList.remove('active');
      welcomePage.classList.add('active');
    });

    // Login with Firebase
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // Fetch user data from Firestore
        const userDoc = await db.collection('users').doc(user.uid).get();
        if (userDoc.exists) {
          const userData = userDoc.data();
          console.log('User data:', userData);

          // Load user data into the UI
          loadProfile(userData.profile);
          document.getElementById('welcome').classList.remove('active');
          mainContent.classList.remove('hidden');
          document.getElementById('level').classList.add('active');
        } else {
          alert('User data not found.');
        }
      } catch (error) {
        alert(error.message);
      }
    });

    // Register with Firebase
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      const confirmPassword = document.getElementById('register-confirm-password').value;

      if (password !== confirmPassword) {
        alert('Passwords do not match.');
        return;
      }

      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // Save user data to Firestore
        await db.collection('users').doc(user.uid).set({
          email: email,
          profile: {
            name: 'John Doe',
            age: 25,
            height: 180,
            weight: 75,
            status: 'Active',
            relationship: 'Single'
          },
          progress: { level: 1, exp: 0 },
          missions: [],
          skills: {
            socialSkills: 0,
            knowledge: 0,
            athleticism: 0,
            individualSkill: 0
          }
        });

        alert('Registration successful! Please login.');
        registerForm.reset();
        registerPage.classList.remove('active');
        welcomePage.classList.add('active');
      } catch (error) {
        alert(error.message);
      }
    });

    // Load profile data
    function loadProfile(profile) {
      document.getElementById('name').value = profile.name;
      document.getElementById('age').value = profile.age;
      document.getElementById('height').value = profile.height;
      document.getElementById('weight').value = profile.weight;
      document.getElementById('status').value = profile.status;
      document.getElementById('relationship').value = profile.relationship;
      document.getElementById('display-name').textContent = profile.name;
    }

    // Save profile data
    async function saveProfile() {
      const user = auth.currentUser;
      if (!user) return;

      const profile = {
        name: document.getElementById('name').value,
        age: document.getElementById('age').value,
        height: document.getElementById('height').value,
        weight: document.getElementById('weight').value,
        status: document.getElementById('status').value,
        relationship: document.getElementById('relationship').value
      };

      await db.collection('users').doc(user.uid).update({ profile });
      alert('Profile saved!');
    }

    // Edit profile logic
    const editButton = document.getElementById('edit-profile');
    const saveButton = document.getElementById('save-profile');

    editButton.addEventListener('click', () => {
      document.querySelectorAll('#profile input').forEach(input => input.disabled = false);
      editButton.classList.add('hidden');
      saveButton.classList.remove('hidden');
    });

    saveButton.addEventListener('click', () => {
      saveProfile();
      document.querySelectorAll('#profile input').forEach(input => input.disabled = true);
      editButton.classList.remove('hidden');
      saveButton.classList.add('hidden');
    });

    // Rest of your existing JavaScript code
  </script>
</body>
</html>